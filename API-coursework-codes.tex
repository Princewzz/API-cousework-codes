% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={API coursework},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{API coursework}
\author{}
\date{\vspace{-2.5em}2024-11-17}

\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\CommentTok{\#delete the row with hypo reading {-}99 standing for NA}
\NormalTok{dmd\_apnoea }\OtherTok{\textless{}{-}}\NormalTok{ dmd\_apnoea }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(hypo }\SpecialCharTok{!=} \SpecialCharTok{{-}}\DecValTok{99}\NormalTok{)}

\NormalTok{dmd\_apnoea }\OtherTok{\textless{}{-}}\NormalTok{ dmd\_apnoea }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{hypo =} \FunctionTok{factor}\NormalTok{(hypo, }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Absent"}\NormalTok{, }\StringTok{"Present"}\NormalTok{)))}

\FunctionTok{ggplot}\NormalTok{(dmd\_apnoea, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ageyears, }\AttributeTok{y =}\NormalTok{ ahi)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}  
  \FunctionTok{facet\_grid}\NormalTok{(hypo }\SpecialCharTok{\textasciitilde{}}\NormalTok{ type) }\SpecialCharTok{+}  
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{x =} \StringTok{"Age (years)"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"AHI (Apnea{-}Hypopnea Index)"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{API-coursework-codes_files/figure-latex/unnamed-chunk-1-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\CommentTok{\#reload the data}
\NormalTok{dmd\_apnoea }\OtherTok{\textless{}{-}} \FunctionTok{read\_table}\NormalTok{(}\StringTok{"C:/Users/liusc/OneDrive/Desktop/Year 4/ASI/Coursework/dmd{-}apnoea.txt"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## -- Column specification --------------------------------------------------------
## cols(
##   patient = col_double(),
##   type = col_character(),
##   ageyears = col_double(),
##   sex = col_character(),
##   echo = col_character(),
##   bb = col_character(),
##   abg = col_character(),
##   mip = col_character(),
##   trach = col_character(),
##   vent = col_character(),
##   snore = col_character(),
##   epwo = col_character(),
##   hypo = col_double(),
##   ahi = col_double(),
##   status = col_character(),
##   deathyrs = col_character()
## )
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Summarize mean and standard deviation of AHI for each disease subtype}
\NormalTok{summary\_stats }\OtherTok{\textless{}{-}}\NormalTok{ dmd\_apnoea }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(type) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{mean\_AHI =} \FunctionTok{mean}\NormalTok{(ahi, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{sd\_AHI =} \FunctionTok{sd}\NormalTok{(ahi, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  )}
\NormalTok{summary\_stats}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 3
##   type  mean_AHI sd_AHI
##   <chr>    <dbl>  <dbl>
## 1 BMD      21.0   15.5 
## 2 CMD       5.08   4.90
## 3 DM        6.87   7.22
## 4 DMD       7.80   9.24
## 5 LGMD      5.98   5.70
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}

\CommentTok{\# Create histogram of AHI distribution}
\FunctionTok{ggplot}\NormalTok{(dmd\_apnoea, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ahi)) }\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{binwidth =} \DecValTok{1}\NormalTok{, }\AttributeTok{fill =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.7}\NormalTok{) }\SpecialCharTok{+}  \CommentTok{\# Adjust binwidth for clarity}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{x =} \StringTok{"AHI"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"Frequency"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{API-coursework-codes_files/figure-latex/unnamed-chunk-3-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Fit linear model}
\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(ahi }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ageyears }\SpecialCharTok{+}\NormalTok{ type }\SpecialCharTok{+}\NormalTok{ sex, }\AttributeTok{data =}\NormalTok{ dmd\_apnoea)}
\FunctionTok{summary}\NormalTok{(model)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = ahi ~ ageyears + type + sex, data = dmd_apnoea)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -16.569  -5.117  -0.742   3.200  41.347 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  15.45920    4.08620   3.783 0.000268 ***
## ageyears      0.14820    0.05365   2.762 0.006869 ** 
## typeCMD     -13.37004    4.22471  -3.165 0.002074 ** 
## typeDM      -12.57604    3.61731  -3.477 0.000761 ***
## typeDMD     -10.82805    3.47821  -3.113 0.002433 ** 
## typeLGMD    -14.30065    3.97744  -3.595 0.000511 ***
## sexM          1.10209    2.26183   0.487 0.627177    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 8.189 on 97 degrees of freedom
## Multiple R-squared:  0.2272, Adjusted R-squared:  0.1794 
## F-statistic: 4.753 on 6 and 97 DF,  p-value: 0.0002758
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Set up a 2x2 layout for the plots}
\FunctionTok{par}\NormalTok{(}\AttributeTok{mfrow =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{))}

\CommentTok{\# Plot the four plots}
\FunctionTok{plot}\NormalTok{(model, }\AttributeTok{which =} \DecValTok{1}\NormalTok{)  }\CommentTok{\# First plot}
\FunctionTok{plot}\NormalTok{(model, }\AttributeTok{which =} \DecValTok{2}\NormalTok{)  }\CommentTok{\# Second plot}
\FunctionTok{plot}\NormalTok{(model, }\AttributeTok{which =} \DecValTok{3}\NormalTok{)  }\CommentTok{\# Third plot}
\FunctionTok{plot}\NormalTok{(model, }\AttributeTok{which =} \DecValTok{5}\NormalTok{)  }\CommentTok{\# Fifth plot)}
\end{Highlighting}
\end{Shaded}

\includegraphics{API-coursework-codes_files/figure-latex/unnamed-chunk-5-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model\_interaction }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(ahi }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ageyears }\SpecialCharTok{*}\NormalTok{ type, }\AttributeTok{data =}\NormalTok{ dmd\_apnoea)}
\FunctionTok{summary}\NormalTok{(model\_interaction)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = ahi ~ ageyears * type, data = dmd_apnoea)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -13.964  -4.630  -1.235   3.198  41.267 
## 
## Coefficients:
##                    Estimate Std. Error t value Pr(>|t|)  
## (Intercept)        11.68235    5.01843   2.328   0.0221 *
## ageyears            0.31006    0.13103   2.366   0.0200 *
## typeCMD           -13.57024   10.98772  -1.235   0.2199  
## typeDM             -7.33746    5.44509  -1.348   0.1810  
## typeDMD            -9.26606    6.41475  -1.444   0.1519  
## typeLGMD           -8.19279    6.56712  -1.248   0.2153  
## ageyears:typeCMD    0.20380    0.70467   0.289   0.7731  
## ageyears:typeDM    -0.20342    0.14794  -1.375   0.1724  
## ageyears:typeDMD    0.07569    0.29999   0.252   0.8014  
## ageyears:typeLGMD  -0.22281    0.18137  -1.228   0.2223  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 8.191 on 94 degrees of freedom
## Multiple R-squared:  0.2507, Adjusted R-squared:  0.1789 
## F-statistic: 3.494 on 9 and 94 DF,  p-value: 0.0009178
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{par}\NormalTok{(}\AttributeTok{mfrow =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{))}

\FunctionTok{plot}\NormalTok{(model\_interaction, }\AttributeTok{which =} \DecValTok{1}\NormalTok{)}
\FunctionTok{plot}\NormalTok{(model\_interaction, }\AttributeTok{which =} \DecValTok{2}\NormalTok{)}
\FunctionTok{plot}\NormalTok{(model\_interaction, }\AttributeTok{which =} \DecValTok{3}\NormalTok{)}
\FunctionTok{plot}\NormalTok{(model\_interaction, }\AttributeTok{which =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{API-coursework-codes_files/figure-latex/unnamed-chunk-7-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(scales)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'scales'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:purrr':
## 
##     discard
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:readr':
## 
##     col_factor
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dmd\_apnoea }\OtherTok{\textless{}{-}}\NormalTok{ dmd\_apnoea }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{age\_group =} \FunctionTok{cut}\NormalTok{(ageyears, }\AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{70}\NormalTok{, }\AttributeTok{by =} \DecValTok{5}\NormalTok{), }\AttributeTok{right =} \ConstantTok{FALSE}\NormalTok{))}

\NormalTok{group\_stats }\OtherTok{\textless{}{-}}\NormalTok{ dmd\_apnoea }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(age\_group) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{mean\_AHI =} \FunctionTok{mean}\NormalTok{(ahi, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{var\_AHI =} \FunctionTok{var}\NormalTok{(ahi, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  )}

\NormalTok{log\_group\_stats }\OtherTok{\textless{}{-}}\NormalTok{ group\_stats }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{log\_mean\_AHI =} \FunctionTok{log}\NormalTok{(mean\_AHI),}
    \AttributeTok{log\_var\_AHI =} \FunctionTok{log}\NormalTok{(var\_AHI)}
\NormalTok{  )}

\FunctionTok{ggplot}\NormalTok{(group\_stats, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mean\_AHI, }\AttributeTok{y =}\NormalTok{ var\_AHI)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_log10}\NormalTok{(}\AttributeTok{labels =} \FunctionTok{label\_log}\NormalTok{()) }\SpecialCharTok{+}  
  \FunctionTok{scale\_y\_log10}\NormalTok{(}\AttributeTok{labels =} \FunctionTok{label\_log}\NormalTok{()) }\SpecialCharTok{+} 
   \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =} \StringTok{"lm"}\NormalTok{, }\AttributeTok{se =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color =} \StringTok{"blue"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{x =} \StringTok{"Log(Mean AHI)"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"Log(Variance of AHI)"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula = 'y ~ x'
\end{verbatim}

\includegraphics{API-coursework-codes_files/figure-latex/unnamed-chunk-8-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{log\_model }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(}\FunctionTok{log}\NormalTok{(var\_AHI) }\SpecialCharTok{\textasciitilde{}} \FunctionTok{log}\NormalTok{(mean\_AHI), }\AttributeTok{data =}\NormalTok{ group\_stats)}

\FunctionTok{summary}\NormalTok{(log\_model)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = log(var_AHI) ~ log(mean_AHI), data = group_stats)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -6.2094 -0.0483  0.5589  0.9554  1.5640 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(>|t|)  
## (Intercept)     -1.134      2.359  -0.481   0.6410  
## log(mean_AHI)    2.122      1.071   1.980   0.0758 .
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.185 on 10 degrees of freedom
## Multiple R-squared:  0.2817, Adjusted R-squared:  0.2099 
## F-statistic: 3.922 on 1 and 10 DF,  p-value: 0.07581
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Filter out zeros}
\NormalTok{dmd\_apnoea\_nonzero }\OtherTok{\textless{}{-}}\NormalTok{ dmd\_apnoea }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(ahi }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{)}

\CommentTok{\# Fit a Gamma GLM}
\NormalTok{gamma\_glm }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(ahi }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ageyears }\SpecialCharTok{+}\NormalTok{ type }\SpecialCharTok{+}\NormalTok{ sex, }
                 \AttributeTok{data =}\NormalTok{ dmd\_apnoea\_nonzero, }
                 \AttributeTok{family =} \FunctionTok{Gamma}\NormalTok{(}\AttributeTok{link =} \StringTok{"log"}\NormalTok{))}

\CommentTok{\# Summary of the model}
\FunctionTok{summary}\NormalTok{(gamma\_glm)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = ahi ~ ageyears + type + sex, family = Gamma(link = "log"), 
##     data = dmd_apnoea_nonzero)
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  2.158300   0.490998   4.396 2.96e-05 ***
## ageyears     0.019382   0.006436   3.011  0.00336 ** 
## typeCMD     -0.878679   0.518121  -1.696  0.09329 .  
## typeDM      -0.794859   0.432345  -1.838  0.06922 .  
## typeDMD     -0.579049   0.417802  -1.386  0.16911    
## typeLGMD    -1.125642   0.475692  -2.366  0.02006 *  
## sexM         0.238376   0.274429   0.869  0.38731    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for Gamma family taken to be 0.957069)
## 
##     Null deviance: 127.83  on 98  degrees of freedom
## Residual deviance: 108.55  on 92  degrees of freedom
## AIC: 614.7
## 
## Number of Fisher Scoring iterations: 8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(boot)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: package 'boot' was built under R version 4.3.3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{bootstrap\_results }\OtherTok{\textless{}{-}}\NormalTok{ boot}\SpecialCharTok{::}\FunctionTok{boot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dmd\_apnoea\_nonzero, }
                                \AttributeTok{statistic =} \ControlFlowTok{function}\NormalTok{(data, indices) \{}
\NormalTok{                                  model }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(ahi }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ageyears }\SpecialCharTok{+}\NormalTok{ type, }
                                               \AttributeTok{data =}\NormalTok{ data[indices, ], }
                                               \AttributeTok{family =} \FunctionTok{Gamma}\NormalTok{(}\AttributeTok{link =} \StringTok{"log"}\NormalTok{))}
                                  \FunctionTok{coef}\NormalTok{(model)[}\StringTok{"ageyears"}\NormalTok{]}
\NormalTok{                                \},}
                                \AttributeTok{R =} \DecValTok{1000}\NormalTok{)}

\CommentTok{\# Confidence interval}
\FunctionTok{boot.ci}\NormalTok{(bootstrap\_results, }\AttributeTok{type =} \StringTok{"perc"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
## Based on 1000 bootstrap replicates
## 
## CALL : 
## boot.ci(boot.out = bootstrap_results, type = "perc")
## 
## Intervals : 
## Level     Percentile     
## 95%   ( 0.0072,  0.0347 )  
## Calculations and Intervals on Original Scale
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create a binary variable for severe sleep apnoea (AHI \textgreater{} 10)}
\NormalTok{dmd\_apnoea }\OtherTok{\textless{}{-}}\NormalTok{ dmd\_apnoea }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{severe\_apnoea =} \FunctionTok{ifelse}\NormalTok{(ahi }\SpecialCharTok{\textgreater{}} \DecValTok{10}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{))}

\CommentTok{\# Fit a logistic regression model}
\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(severe\_apnoea }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ageyears }\SpecialCharTok{+}\NormalTok{ type, }
             \AttributeTok{data =}\NormalTok{ dmd\_apnoea, }
             \AttributeTok{family =} \FunctionTok{binomial}\NormalTok{(}\AttributeTok{link =} \StringTok{"logit"}\NormalTok{))}

\CommentTok{\# Summary of the model to see coefficients}
\FunctionTok{summary}\NormalTok{(model)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = severe_apnoea ~ ageyears + type, family = binomial(link = "logit"), 
##     data = dmd_apnoea)
## 
## Coefficients:
##             Estimate Std. Error z value Pr(>|z|)   
## (Intercept) -0.21569    0.97262  -0.222   0.8245   
## ageyears     0.04629    0.01728   2.678   0.0074 **
## typeCMD     -1.67373    1.22212  -1.370   0.1708   
## typeDM      -2.38158    1.03972  -2.291   0.0220 * 
## typeDMD     -1.47236    0.99148  -1.485   0.1375   
## typeLGMD    -3.05086    1.27463  -2.394   0.0167 * 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 119.11  on 103  degrees of freedom
## Residual deviance: 103.33  on  98  degrees of freedom
## AIC: 115.33
## 
## Number of Fisher Scoring iterations: 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Odds ratio for a 10{-}year increase in age}
\NormalTok{age\_effect }\OtherTok{\textless{}{-}} \FunctionTok{exp}\NormalTok{(}\FunctionTok{coef}\NormalTok{(model)[}\StringTok{"ageyears"}\NormalTok{] }\SpecialCharTok{*} \DecValTok{10}\NormalTok{)}
\NormalTok{age\_effect}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## ageyears 
## 1.588617
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# To get a confidence interval for the odds ratio (using bootstrap)}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{bootstrap\_results }\OtherTok{\textless{}{-}}\NormalTok{ boot}\SpecialCharTok{::}\FunctionTok{boot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dmd\_apnoea, }
                                \AttributeTok{statistic =} \ControlFlowTok{function}\NormalTok{(data, indices) \{}
\NormalTok{                                  model }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(severe\_apnoea }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ageyears }\SpecialCharTok{+}\NormalTok{ type, }
                                               \AttributeTok{data =}\NormalTok{ data[indices, ], }
                                               \AttributeTok{family =} \FunctionTok{binomial}\NormalTok{(}\AttributeTok{link =} \StringTok{"logit"}\NormalTok{))}
                                  \FunctionTok{exp}\NormalTok{(}\FunctionTok{coef}\NormalTok{(model)[}\StringTok{"ageyears"}\NormalTok{] }\SpecialCharTok{*} \DecValTok{10}\NormalTok{)  }\CommentTok{\# Exponentiate the age coefficient}
\NormalTok{                                \},}
                                \AttributeTok{R =} \DecValTok{1000}\NormalTok{)}

\CommentTok{\# Confidence interval for the odds ratio}
\FunctionTok{boot.ci}\NormalTok{(bootstrap\_results, }\AttributeTok{type =} \StringTok{"perc"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
## Based on 1000 bootstrap replicates
## 
## CALL : 
## boot.ci(boot.out = bootstrap_results, type = "perc")
## 
## Intervals : 
## Level     Percentile     
## 95%   ( 1.180,  3.364 )  
## Calculations and Intervals on Original Scale
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{coef\_estimates }\OtherTok{\textless{}{-}} \FunctionTok{coef}\NormalTok{(}\FunctionTok{summary}\NormalTok{(gamma\_glm))}
\NormalTok{conf\_intervals }\OtherTok{\textless{}{-}} \FunctionTok{confint}\NormalTok{(gamma\_glm)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Waiting for profiling to be done...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gamma\_glm }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(ahi }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ageyears }\SpecialCharTok{+}\NormalTok{ type, }
                 \AttributeTok{data =}\NormalTok{ dmd\_apnoea\_nonzero, }
                 \AttributeTok{family =} \FunctionTok{Gamma}\NormalTok{(}\AttributeTok{link =} \StringTok{"log"}\NormalTok{))}
\CommentTok{\# Predict the mean AHI for individuals with DMD subtype at age 18}
\NormalTok{age }\OtherTok{\textless{}{-}} \DecValTok{18}
\NormalTok{type }\OtherTok{\textless{}{-}} \StringTok{"DMD"}
\NormalTok{new\_data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{ageyears =} \DecValTok{18}\NormalTok{, }\AttributeTok{type =} \StringTok{"DMD"}\NormalTok{)}

\CommentTok{\# Predict mean AHI}
\NormalTok{predicted\_mean\_log\_ahi }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(gamma\_glm, }\AttributeTok{newdata =}\NormalTok{ new\_data, }\AttributeTok{type =} \StringTok{"link"}\NormalTok{, }\AttributeTok{se.fit =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{predicted\_mean\_ahi }\OtherTok{\textless{}{-}} \FunctionTok{exp}\NormalTok{(predicted\_mean\_log\_ahi}\SpecialCharTok{$}\NormalTok{fit)}

\CommentTok{\# Calculate confidence intervals for the mean AHI}
\NormalTok{lower\_ci\_log }\OtherTok{\textless{}{-}}\NormalTok{ predicted\_mean\_log\_ahi}\SpecialCharTok{$}\NormalTok{fit }\SpecialCharTok{{-}} \FloatTok{1.96} \SpecialCharTok{*}\NormalTok{ predicted\_mean\_log\_ahi}\SpecialCharTok{$}\NormalTok{se.fit}
\NormalTok{upper\_ci\_log }\OtherTok{\textless{}{-}}\NormalTok{ predicted\_mean\_log\_ahi}\SpecialCharTok{$}\NormalTok{fit }\SpecialCharTok{+} \FloatTok{1.96} \SpecialCharTok{*}\NormalTok{ predicted\_mean\_log\_ahi}\SpecialCharTok{$}\NormalTok{se.fit}
\NormalTok{lower\_ci\_ahi }\OtherTok{\textless{}{-}} \FunctionTok{exp}\NormalTok{(lower\_ci\_log)}
\NormalTok{upper\_ci\_ahi }\OtherTok{\textless{}{-}} \FunctionTok{exp}\NormalTok{(upper\_ci\_log)}

\CommentTok{\# Estimate proportion with severe sleep apnoea (AHI \textgreater{} 30) at age 18}
\NormalTok{shape\_param }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{/} \FunctionTok{summary}\NormalTok{(gamma\_glm)}\SpecialCharTok{$}\NormalTok{deviance }\SpecialCharTok{/} \FunctionTok{summary}\NormalTok{(gamma\_glm)}\SpecialCharTok{$}\NormalTok{df.residual }\CommentTok{\# Gamma shape parameter}
\NormalTok{scale\_param }\OtherTok{\textless{}{-}}\NormalTok{ predicted\_mean\_ahi }\SpecialCharTok{/}\NormalTok{ shape\_param }\CommentTok{\# Scale parameter}

\CommentTok{\# Cumulative probability for AHI \textless{}= 30}
\NormalTok{p\_ahi\_30 }\OtherTok{\textless{}{-}} \FunctionTok{pgamma}\NormalTok{(}\DecValTok{30}\NormalTok{, }\AttributeTok{shape =}\NormalTok{ shape\_param, }\AttributeTok{scale =}\NormalTok{ scale\_param)}

\CommentTok{\# Proportion with severe sleep apnoea}
\NormalTok{proportion\_severe }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_ahi\_30}
\NormalTok{proportion\_severe\_u }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}} \FunctionTok{pgamma}\NormalTok{(}\DecValTok{30}\NormalTok{, }\AttributeTok{shape =}\NormalTok{ shape\_param, }\AttributeTok{scale =}\NormalTok{ lower\_ci\_ahi }\SpecialCharTok{/}\NormalTok{ shape\_param )}
\NormalTok{proportion\_severe\_d }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}} \FunctionTok{pgamma}\NormalTok{(}\DecValTok{30}\NormalTok{, }\AttributeTok{shape =}\NormalTok{ shape\_param, }\AttributeTok{scale =}\NormalTok{ upper\_ci\_ahi }\SpecialCharTok{/}\NormalTok{ shape\_param )}

\CommentTok{\# Display results}
\FunctionTok{list}\NormalTok{(}
  \AttributeTok{Predicted\_Mean\_AHI =}\NormalTok{ predicted\_mean\_ahi,}
  \AttributeTok{CI\_AHI =} \FunctionTok{c}\NormalTok{(lower\_ci\_ahi, upper\_ci\_ahi),}
  \AttributeTok{Proportion\_Severe =}\NormalTok{ proportion\_severe, }
  \AttributeTok{CI\_Proportion\_Severe =} \FunctionTok{c}\NormalTok{(proportion\_severe\_u, proportion\_severe\_d)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $Predicted_Mean_AHI
##        1 
## 8.712741 
## 
## $CI_AHI
##         1         1 
##  6.332426 11.987799 
## 
## $Proportion_Severe
## [1] 0.0007290711
## 
## $CI_Proportion_Severe
## [1] 0.0006977126 0.0007604320
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{coef\_estimates }\OtherTok{\textless{}{-}} \FunctionTok{coef}\NormalTok{(}\FunctionTok{summary}\NormalTok{(gamma\_glm))}
\NormalTok{conf\_intervals }\OtherTok{\textless{}{-}} \FunctionTok{confint}\NormalTok{(gamma\_glm)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Waiting for profiling to be done...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Predict the mean AHI for individuals with DMD subtype at age 18}
\NormalTok{age }\OtherTok{\textless{}{-}} \DecValTok{60}
\NormalTok{type }\OtherTok{\textless{}{-}} \StringTok{"DMD"}
\NormalTok{new\_data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{ageyears =}\NormalTok{ age, }\AttributeTok{type =}\NormalTok{ type)}

\CommentTok{\# Predict mean AHI}
\NormalTok{predicted\_mean\_log\_ahi }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(gamma\_glm, }\AttributeTok{newdata =}\NormalTok{ new\_data, }\AttributeTok{type =} \StringTok{"link"}\NormalTok{, }\AttributeTok{se.fit =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{predicted\_mean\_ahi }\OtherTok{\textless{}{-}} \FunctionTok{exp}\NormalTok{(predicted\_mean\_log\_ahi}\SpecialCharTok{$}\NormalTok{fit)}

\CommentTok{\# Calculate confidence intervals for the mean AHI}
\NormalTok{lower\_ci\_log }\OtherTok{\textless{}{-}}\NormalTok{ predicted\_mean\_log\_ahi}\SpecialCharTok{$}\NormalTok{fit }\SpecialCharTok{{-}} \FloatTok{1.96} \SpecialCharTok{*}\NormalTok{ predicted\_mean\_log\_ahi}\SpecialCharTok{$}\NormalTok{se.fit}
\NormalTok{upper\_ci\_log }\OtherTok{\textless{}{-}}\NormalTok{ predicted\_mean\_log\_ahi}\SpecialCharTok{$}\NormalTok{fit }\SpecialCharTok{+} \FloatTok{1.96} \SpecialCharTok{*}\NormalTok{ predicted\_mean\_log\_ahi}\SpecialCharTok{$}\NormalTok{se.fit}
\NormalTok{lower\_ci\_ahi }\OtherTok{\textless{}{-}} \FunctionTok{exp}\NormalTok{(lower\_ci\_log)}
\NormalTok{upper\_ci\_ahi }\OtherTok{\textless{}{-}} \FunctionTok{exp}\NormalTok{(upper\_ci\_log)}

\CommentTok{\# Estimate proportion with severe sleep apnoea (AHI \textgreater{} 30) at age 18}
\NormalTok{shape\_param }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{/} \FunctionTok{summary}\NormalTok{(gamma\_glm)}\SpecialCharTok{$}\NormalTok{deviance }\SpecialCharTok{/} \FunctionTok{summary}\NormalTok{(gamma\_glm)}\SpecialCharTok{$}\NormalTok{df.residual }\CommentTok{\# Gamma shape parameter}
\NormalTok{scale\_param }\OtherTok{\textless{}{-}}\NormalTok{ predicted\_mean\_ahi }\SpecialCharTok{/}\NormalTok{ shape\_param }\CommentTok{\# Scale parameter}

\CommentTok{\# Cumulative probability for AHI \textless{}= 30}
\NormalTok{p\_ahi\_30 }\OtherTok{\textless{}{-}} \FunctionTok{pgamma}\NormalTok{(}\DecValTok{30}\NormalTok{, }\AttributeTok{shape =}\NormalTok{ shape\_param, }\AttributeTok{scale =}\NormalTok{ scale\_param)}

\CommentTok{\# Proportion with severe sleep apnoea}
\NormalTok{proportion\_severe }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_ahi\_30}
\NormalTok{proportion\_severe\_u }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}} \FunctionTok{pgamma}\NormalTok{(}\DecValTok{30}\NormalTok{, }\AttributeTok{shape =}\NormalTok{ shape\_param, }\AttributeTok{scale =}\NormalTok{ lower\_ci\_ahi }\SpecialCharTok{/}\NormalTok{ shape\_param )}
\NormalTok{proportion\_severe\_d }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}} \FunctionTok{pgamma}\NormalTok{(}\DecValTok{30}\NormalTok{, }\AttributeTok{shape =}\NormalTok{ shape\_param, }\AttributeTok{scale =}\NormalTok{ upper\_ci\_ahi }\SpecialCharTok{/}\NormalTok{ shape\_param )}

\CommentTok{\# Display results}
\FunctionTok{list}\NormalTok{(}
  \AttributeTok{Predicted\_Mean\_AHI =}\NormalTok{ predicted\_mean\_ahi,}
  \AttributeTok{CI\_AHI =} \FunctionTok{c}\NormalTok{(lower\_ci\_ahi, upper\_ci\_ahi),}
  \AttributeTok{Proportion\_Severe =}\NormalTok{ proportion\_severe, }
  \AttributeTok{CI\_Proportion\_Severe =} \FunctionTok{c}\NormalTok{(proportion\_severe\_u, proportion\_severe\_d)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $Predicted_Mean_AHI
##        1 
## 19.21817 
## 
## $CI_AHI
##        1        1 
##  9.99198 36.96343 
## 
## $Proportion_Severe
## [1] 0.0008068186
## 
## $CI_Proportion_Severe
## [1] 0.0007425346 0.0008711051
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Simulating data}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\NormalTok{n }\OtherTok{\textless{}{-}} \DecValTok{100}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{runif}\NormalTok{(n, }\DecValTok{1}\NormalTok{, }\DecValTok{10}\NormalTok{)  }\CommentTok{\# Predictor variable}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{rgamma}\NormalTok{(n, }\AttributeTok{shape =} \DecValTok{2}\NormalTok{, }\AttributeTok{rate =} \DecValTok{1} \SpecialCharTok{/}\NormalTok{ (}\FloatTok{0.5} \SpecialCharTok{+} \FloatTok{0.3} \SpecialCharTok{*}\NormalTok{ x))  }\CommentTok{\# Gamma response variable}

\CommentTok{\# Fitting a Gamma GLM}
\NormalTok{gamma\_glm }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x, }\AttributeTok{family =} \FunctionTok{Gamma}\NormalTok{(}\AttributeTok{link =} \StringTok{"log"}\NormalTok{))}

\CommentTok{\# Extracting deviance residuals}
\NormalTok{deviance\_residuals }\OtherTok{\textless{}{-}} \FunctionTok{residuals}\NormalTok{(gamma\_glm, }\AttributeTok{type =} \StringTok{"deviance"}\NormalTok{)}

\CommentTok{\# Creating a deviance plot}
\FunctionTok{plot}\NormalTok{(}
\NormalTok{  gamma\_glm}\SpecialCharTok{$}\NormalTok{fitted.values, deviance\_residuals,}
  \AttributeTok{xlab =} \StringTok{"Fitted Values"}\NormalTok{,}
  \AttributeTok{ylab =} \StringTok{"Deviance Residuals"}\NormalTok{,}
  \AttributeTok{pch =} \DecValTok{19}\NormalTok{,}
  \AttributeTok{col =} \StringTok{"blue"}
\NormalTok{)}
\FunctionTok{abline}\NormalTok{(}\AttributeTok{h =} \DecValTok{0}\NormalTok{, }\AttributeTok{col =} \StringTok{"red"}\NormalTok{, }\AttributeTok{lwd =} \DecValTok{2}\NormalTok{)}

\CommentTok{\# Optionally: Adding a smoother for visualization}
\FunctionTok{lines}\NormalTok{(}\FunctionTok{lowess}\NormalTok{(gamma\_glm}\SpecialCharTok{$}\NormalTok{fitted.values, deviance\_residuals), }\AttributeTok{col =} \StringTok{"darkgreen"}\NormalTok{, }\AttributeTok{lwd =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{API-coursework-codes_files/figure-latex/unnamed-chunk-14-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_master }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"C:}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{Users}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{liusc}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{OneDrive}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{Desktop}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{Year 4}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{ASI}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{Coursework}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{oi{-}bmi.csv"}\NormalTok{)}
\CommentTok{\# Rename columns for clarity}
\FunctionTok{colnames}\NormalTok{(data\_master) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"X1"}\NormalTok{, }\StringTok{"X2"}\NormalTok{)}


\CommentTok{\# Basic exploration}
\FunctionTok{summary}\NormalTok{(data\_master)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        X1              X2         
##  Min.   :11.70   Min.   :-2.3099  
##  1st Qu.:17.61   1st Qu.: 0.5251  
##  Median :21.99   Median : 1.6378  
##  Mean   :22.78   Mean   : 1.2793  
##  3rd Qu.:26.56   3rd Qu.: 2.6498  
##  Max.   :62.40   Max.   : 4.4179
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(data\_master}\SpecialCharTok{$}\NormalTok{X1, data\_master}\SpecialCharTok{$}\NormalTok{X2, }
     \AttributeTok{xlab =} \StringTok{"BMI"}\NormalTok{, }
     \AttributeTok{ylab =} \StringTok{"Log OI during REM Sleep"}\NormalTok{, }
     \AttributeTok{pch =} \DecValTok{16}\NormalTok{,        }\CommentTok{\# Use solid dots}
     \AttributeTok{col =} \StringTok{"blue"}\NormalTok{,}
     \AttributeTok{cex =} \FloatTok{0.7}\NormalTok{) }

\CommentTok{\# Linear regression}
\NormalTok{model\_master}\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(X2 }\SpecialCharTok{\textasciitilde{}}\NormalTok{ X1, }\AttributeTok{data =}\NormalTok{ data\_master)}
\FunctionTok{summary}\NormalTok{(model\_master)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = X2 ~ X1, data = data_master)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.0912 -0.6052  0.4421  1.1697  3.1210 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept) -0.80138    0.43968  -1.823   0.0703 .  
## X1           0.09132    0.01832   4.984 1.67e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.718 on 153 degrees of freedom
## Multiple R-squared:  0.1397, Adjusted R-squared:  0.1341 
## F-statistic: 24.84 on 1 and 153 DF,  p-value: 1.666e-06
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Add regression line to plot}
\FunctionTok{abline}\NormalTok{(model\_master, }\AttributeTok{col =} \StringTok{"black"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{API-coursework-codes_files/figure-latex/unnamed-chunk-15-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# GEE model (requires geepack library)}
\CommentTok{\# Model diagnostics (for lm)}
\FunctionTok{par}\NormalTok{(}\AttributeTok{mfrow =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{))}

\CommentTok{\# Plot the four plots}
\FunctionTok{plot}\NormalTok{(model\_master, }\AttributeTok{which =} \DecValTok{1}\NormalTok{)  }
\FunctionTok{plot}\NormalTok{(model\_master, }\AttributeTok{which =} \DecValTok{2}\NormalTok{)  }
\FunctionTok{plot}\NormalTok{(model\_master, }\AttributeTok{which =} \DecValTok{3}\NormalTok{)  }
\FunctionTok{plot}\NormalTok{(model\_master, }\AttributeTok{which =} \DecValTok{5}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{API-coursework-codes_files/figure-latex/unnamed-chunk-15-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_master}\SpecialCharTok{$}\NormalTok{OI }\OtherTok{\textless{}{-}} \FunctionTok{exp}\NormalTok{(data\_master}\SpecialCharTok{$}\NormalTok{X2)}
\CommentTok{\# Remove rows where X2\_adjusted is zero or negative}
\NormalTok{model\_master\_glm\_unlogged }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(OI }\SpecialCharTok{\textasciitilde{}}\NormalTok{ X1, }\AttributeTok{data =}\NormalTok{ data\_master, }\AttributeTok{family =} \FunctionTok{gaussian}\NormalTok{(}\AttributeTok{link =} \StringTok{"log"}\NormalTok{))}
\FunctionTok{summary}\NormalTok{(model\_master\_glm\_unlogged)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = OI ~ X1, family = gaussian(link = "log"), data = data_master)
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  1.24987    0.18886   6.618 5.78e-10 ***
## X1           0.04749    0.00446  10.646  < 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for gaussian family taken to be 175.939)
## 
##     Null deviance: 36674  on 154  degrees of freedom
## Residual deviance: 26920  on 153  degrees of freedom
## AIC: 1245.2
## 
## Number of Fisher Scoring iterations: 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(data\_master}\SpecialCharTok{$}\NormalTok{X1, data\_master}\SpecialCharTok{$}\NormalTok{OI, }
     \AttributeTok{xlab =} \StringTok{"BMI"}\NormalTok{, }
     \AttributeTok{ylab =} \StringTok{"OI"}\NormalTok{, }
     \AttributeTok{pch =} \DecValTok{19}\NormalTok{, }\AttributeTok{col =} \StringTok{"blue"}\NormalTok{)}

\CommentTok{\# Add the fitted line from the unlogged model}
\NormalTok{fitted\_values\_unlogged }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(model\_master\_glm\_unlogged, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}
\FunctionTok{lines}\NormalTok{(data\_master}\SpecialCharTok{$}\NormalTok{X1, fitted\_values\_unlogged, }\AttributeTok{col =} \StringTok{"red"}\NormalTok{, }\AttributeTok{lwd =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{API-coursework-codes_files/figure-latex/unnamed-chunk-16-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_master}\SpecialCharTok{$}\NormalTok{OI }\OtherTok{\textless{}{-}} \FunctionTok{exp}\NormalTok{(data\_master}\SpecialCharTok{$}\NormalTok{X2)}
\NormalTok{model\_master\_glm\_unlogged }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(OI }\SpecialCharTok{\textasciitilde{}}\NormalTok{ X1, }\AttributeTok{data =}\NormalTok{ data\_master, }\AttributeTok{family =} \FunctionTok{Gamma}\NormalTok{(}\AttributeTok{link =} \StringTok{"log"}\NormalTok{))}
\FunctionTok{summary}\NormalTok{(model\_master\_glm\_unlogged)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = OI ~ X1, family = Gamma(link = "log"), data = data_master)
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  0.57840    0.34848   1.660    0.099 .  
## X1           0.07206    0.01452   4.962 1.84e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for Gamma family taken to be 1.855142)
## 
##     Null deviance: 342.4  on 154  degrees of freedom
## Residual deviance: 291.7  on 153  degrees of freedom
## AIC: 985.53
## 
## Number of Fisher Scoring iterations: 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(data\_master}\SpecialCharTok{$}\NormalTok{X1, data\_master}\SpecialCharTok{$}\NormalTok{OI, }
     \AttributeTok{xlab =} \StringTok{"BMI"}\NormalTok{, }
     \AttributeTok{ylab =} \StringTok{"OI"}\NormalTok{, }
     \AttributeTok{pch =} \DecValTok{19}\NormalTok{, }\AttributeTok{col =} \StringTok{"blue"}\NormalTok{)}

\CommentTok{\# Add the fitted line from the unlogged model}
\NormalTok{fitted\_values\_unlogged }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(model\_master\_glm\_unlogged, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}
\FunctionTok{lines}\NormalTok{(data\_master}\SpecialCharTok{$}\NormalTok{X1, fitted\_values\_unlogged, }\AttributeTok{col =} \StringTok{"red"}\NormalTok{, }\AttributeTok{lwd =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{API-coursework-codes_files/figure-latex/unnamed-chunk-17-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{deviance\_residuals }\OtherTok{\textless{}{-}} \FunctionTok{residuals}\NormalTok{(model\_master\_glm\_unlogged, }\AttributeTok{type =} \StringTok{"deviance"}\NormalTok{)}

\CommentTok{\# Plot deviance residuals vs fitted values}
\FunctionTok{plot}\NormalTok{(}\FunctionTok{fitted}\NormalTok{(model\_master\_glm\_unlogged), deviance\_residuals,}
     \AttributeTok{main =} \StringTok{"Deviance Residuals vs Fitted Values"}\NormalTok{,}
     \AttributeTok{xlab =} \StringTok{"Fitted Values"}\NormalTok{, }\AttributeTok{ylab =} \StringTok{"Deviance Residuals"}\NormalTok{,}
     \AttributeTok{pch =} \DecValTok{19}\NormalTok{, }\AttributeTok{col =} \StringTok{"blue"}\NormalTok{)}

\CommentTok{\# Add a horizontal line at 0}
\FunctionTok{abline}\NormalTok{(}\AttributeTok{h =} \DecValTok{0}\NormalTok{, }\AttributeTok{col =} \StringTok{"red"}\NormalTok{, }\AttributeTok{lwd =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{API-coursework-codes_files/figure-latex/unnamed-chunk-18-1.pdf}

\end{document}
